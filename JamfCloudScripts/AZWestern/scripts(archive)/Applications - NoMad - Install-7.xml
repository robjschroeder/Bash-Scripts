<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<script>
    <id>7</id>
    <name>Applications - NoMad - Install</name>
    <category>Utilities</category>
    <filename>Applications - NoMad - Install</filename>
    <info></info>
    <notes></notes>
    <priority>After</priority>
    <parameters></parameters>
    <os_requirements></os_requirements>
    <script_contents>#!/bin/bash

log() {
    echo "$1"
    /usr/bin/logger -t "NoMAD Installer:" "$1"
}
#log "Installing NoMAD.app"

#tempDir=$(/usr/bin/mktemp -d -t "NoMAD_Installer")

#cleanUp() {
#    log "Performing cleanup tasks..."
#    /bin/rm -r "$tempDir"
#}

#trap cleanUp exit

loggedInUserPid=$(python -c 'from SystemConfiguration import SCDynamicStoreCopyConsoleUser; username = SCDynamicStoreCopyConsoleUser(None, None, None)[1]; print(username);')
launchctlCmd=$(python -c 'import platform; from distutils.version import StrictVersion as SV; print("asuser") if SV(platform.mac_ver()[0]) &gt;= SV("10.10") else "bsexec"')

#packageDownloadUrl="https://www.nomad.menu/download/NoMAD.pkg"

#pkgExpectedSize=$(/usr/bin/curl $packageDownloadUrl -ILs | /usr/bin/tr -d '\r' | /usr/bin/awk '/Content-Length:/ {print $2}')

#log "Downloading NoMAD.pkg..."
#/usr/bin/curl -s $packageDownloadUrl -o "$tempDir/NoMAD.pkg"
#if [ $? -ne 0 ]; then
#    log "curl error: The package did not successfully download"; exit 1
#fi

#pkgDownloadedSize=$(/usr/bin/cksum "$tempDir/NoMAD.pkg" | /usr/bin/awk '{print $2}')
#log "Expected size: $pkgExpectedSize; Downloaded size: $pkgDownloadedSize"
#if [[ $pkgExpectedSize -ne $pkgDownloadedSize ]]; then
#    log "The package did not download properly"; exit 1
#fi

#log "Installing NoMAD.app..."
#/usr/sbin/installer -pkg "$tempDir/NoMAD.pkg" -target /
#if [ $? -ne 0 ]; then
#    log "installer error: The package did not successfully install"; exit 1
#fi

log "Writing LaunchAgent..."
read -d '' launchAgent &lt;&lt;"EOF"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
    &lt;dict&gt;
        &lt;key&gt;KeepAlive&lt;/key&gt;
        &lt;true/&gt;
        &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;com.trusourcelabs.NoMAD&lt;/string&gt;
        &lt;key&gt;LimitLoadToSessionType&lt;/key&gt;
        &lt;array&gt;
        &lt;string&gt;Aqua&lt;/string&gt;
        &lt;/array&gt;
        &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
        &lt;string&gt;/Applications/NoMAD.app/Contents/MacOS/NoMAD&lt;/string&gt;
        &lt;/array&gt;
        &lt;key&gt;RunAtLoad&lt;/key&gt;
        &lt;true/&gt;
    &lt;/dict&gt;
&lt;/plist&gt;
EOF
echo "$launchAgent" &gt; /Library/LaunchAgents/com.trusourcelabs.NoMAD.plist

/usr/sbin/chown root:wheel /Library/LaunchAgents/com.trusourcelabs.NoMAD.plist
/bin/chmod 644 /Library/LaunchAgents/com.trusourcelabs.NoMAD.plist

log "Loading LaunchAgent..."
/bin/launchctl "$launchctlCmd" "$loggedInUserPid" /bin/launchctl load /Library/LaunchAgents/com.trusourcelabs.NoMAD.plist
if [ $? -ne 0 ]; then
    log "launchctl error: The LaunchAgent failed to load"; exit 1
fi

log "NoMAD.app install complete"
exit 0</script_contents>
    <script_contents_encoded>IyEvYmluL2Jhc2gKCmxvZygpIHsKICAgIGVjaG8gIiQxIgogICAgL3Vzci9iaW4vbG9nZ2VyIC10ICJOb01BRCBJbnN0YWxsZXI6IiAiJDEiCn0KI2xvZyAiSW5zdGFsbGluZyBOb01BRC5hcHAiCgojdGVtcERpcj0kKC91c3IvYmluL21rdGVtcCAtZCAtdCAiTm9NQURfSW5zdGFsbGVyIikKCiNjbGVhblVwKCkgewojICAgIGxvZyAiUGVyZm9ybWluZyBjbGVhbnVwIHRhc2tzLi4uIgojICAgIC9iaW4vcm0gLXIgIiR0ZW1wRGlyIgojfQoKI3RyYXAgY2xlYW5VcCBleGl0Cgpsb2dnZWRJblVzZXJQaWQ9JChweXRob24gLWMgJ2Zyb20gU3lzdGVtQ29uZmlndXJhdGlvbiBpbXBvcnQgU0NEeW5hbWljU3RvcmVDb3B5Q29uc29sZVVzZXI7IHVzZXJuYW1lID0gU0NEeW5hbWljU3RvcmVDb3B5Q29uc29sZVVzZXIoTm9uZSwgTm9uZSwgTm9uZSlbMV07IHByaW50KHVzZXJuYW1lKTsnKQpsYXVuY2hjdGxDbWQ9JChweXRob24gLWMgJ2ltcG9ydCBwbGF0Zm9ybTsgZnJvbSBkaXN0dXRpbHMudmVyc2lvbiBpbXBvcnQgU3RyaWN0VmVyc2lvbiBhcyBTVjsgcHJpbnQoImFzdXNlciIpIGlmIFNWKHBsYXRmb3JtLm1hY192ZXIoKVswXSkgPj0gU1YoIjEwLjEwIikgZWxzZSAiYnNleGVjIicpCgojcGFja2FnZURvd25sb2FkVXJsPSJodHRwczovL3d3dy5ub21hZC5tZW51L2Rvd25sb2FkL05vTUFELnBrZyIKCiNwa2dFeHBlY3RlZFNpemU9JCgvdXNyL2Jpbi9jdXJsICRwYWNrYWdlRG93bmxvYWRVcmwgLUlMcyB8IC91c3IvYmluL3RyIC1kICdccicgfCAvdXNyL2Jpbi9hd2sgJy9Db250ZW50LUxlbmd0aDovIHtwcmludCAkMn0nKQoKI2xvZyAiRG93bmxvYWRpbmcgTm9NQUQucGtnLi4uIgojL3Vzci9iaW4vY3VybCAtcyAkcGFja2FnZURvd25sb2FkVXJsIC1vICIkdGVtcERpci9Ob01BRC5wa2ciCiNpZiBbICQ/IC1uZSAwIF07IHRoZW4KIyAgICBsb2cgImN1cmwgZXJyb3I6IFRoZSBwYWNrYWdlIGRpZCBub3Qgc3VjY2Vzc2Z1bGx5IGRvd25sb2FkIjsgZXhpdCAxCiNmaQoKI3BrZ0Rvd25sb2FkZWRTaXplPSQoL3Vzci9iaW4vY2tzdW0gIiR0ZW1wRGlyL05vTUFELnBrZyIgfCAvdXNyL2Jpbi9hd2sgJ3twcmludCAkMn0nKQojbG9nICJFeHBlY3RlZCBzaXplOiAkcGtnRXhwZWN0ZWRTaXplOyBEb3dubG9hZGVkIHNpemU6ICRwa2dEb3dubG9hZGVkU2l6ZSIKI2lmIFtbICRwa2dFeHBlY3RlZFNpemUgLW5lICRwa2dEb3dubG9hZGVkU2l6ZSBdXTsgdGhlbgojICAgIGxvZyAiVGhlIHBhY2thZ2UgZGlkIG5vdCBkb3dubG9hZCBwcm9wZXJseSI7IGV4aXQgMQojZmkKCiNsb2cgIkluc3RhbGxpbmcgTm9NQUQuYXBwLi4uIgojL3Vzci9zYmluL2luc3RhbGxlciAtcGtnICIkdGVtcERpci9Ob01BRC5wa2ciIC10YXJnZXQgLwojaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiMgICAgbG9nICJpbnN0YWxsZXIgZXJyb3I6IFRoZSBwYWNrYWdlIGRpZCBub3Qgc3VjY2Vzc2Z1bGx5IGluc3RhbGwiOyBleGl0IDEKI2ZpCgpsb2cgIldyaXRpbmcgTGF1bmNoQWdlbnQuLi4iCnJlYWQgLWQgJycgbGF1bmNoQWdlbnQgPDwiRU9GIgo8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/Pgo8IURPQ1RZUEUgcGxpc3QgUFVCTElDICItLy9BcHBsZS8vRFREIFBMSVNUIDEuMC8vRU4iICJodHRwOi8vd3d3LmFwcGxlLmNvbS9EVERzL1Byb3BlcnR5TGlzdC0xLjAuZHRkIj4KPHBsaXN0IHZlcnNpb249IjEuMCI+CiAgICA8ZGljdD4KICAgICAgICA8a2V5PktlZXBBbGl2ZTwva2V5PgogICAgICAgIDx0cnVlLz4KICAgICAgICA8a2V5PkxhYmVsPC9rZXk+CiAgICAgICAgPHN0cmluZz5jb20udHJ1c291cmNlbGFicy5Ob01BRDwvc3RyaW5nPgogICAgICAgIDxrZXk+TGltaXRMb2FkVG9TZXNzaW9uVHlwZTwva2V5PgogICAgICAgIDxhcnJheT4KICAgICAgICA8c3RyaW5nPkFxdWE8L3N0cmluZz4KICAgICAgICA8L2FycmF5PgogICAgICAgIDxrZXk+UHJvZ3JhbUFyZ3VtZW50czwva2V5PgogICAgICAgIDxhcnJheT4KICAgICAgICA8c3RyaW5nPi9BcHBsaWNhdGlvbnMvTm9NQUQuYXBwL0NvbnRlbnRzL01hY09TL05vTUFEPC9zdHJpbmc+CiAgICAgICAgPC9hcnJheT4KICAgICAgICA8a2V5PlJ1bkF0TG9hZDwva2V5PgogICAgICAgIDx0cnVlLz4KICAgIDwvZGljdD4KPC9wbGlzdD4KRU9GCmVjaG8gIiRsYXVuY2hBZ2VudCIgPiAvTGlicmFyeS9MYXVuY2hBZ2VudHMvY29tLnRydXNvdXJjZWxhYnMuTm9NQUQucGxpc3QKCi91c3Ivc2Jpbi9jaG93biByb290OndoZWVsIC9MaWJyYXJ5L0xhdW5jaEFnZW50cy9jb20udHJ1c291cmNlbGFicy5Ob01BRC5wbGlzdAovYmluL2NobW9kIDY0NCAvTGlicmFyeS9MYXVuY2hBZ2VudHMvY29tLnRydXNvdXJjZWxhYnMuTm9NQUQucGxpc3QKCmxvZyAiTG9hZGluZyBMYXVuY2hBZ2VudC4uLiIKL2Jpbi9sYXVuY2hjdGwgIiRsYXVuY2hjdGxDbWQiICIkbG9nZ2VkSW5Vc2VyUGlkIiAvYmluL2xhdW5jaGN0bCBsb2FkIC9MaWJyYXJ5L0xhdW5jaEFnZW50cy9jb20udHJ1c291cmNlbGFicy5Ob01BRC5wbGlzdAppZiBbICQ/IC1uZSAwIF07IHRoZW4KICAgIGxvZyAibGF1bmNoY3RsIGVycm9yOiBUaGUgTGF1bmNoQWdlbnQgZmFpbGVkIHRvIGxvYWQiOyBleGl0IDEKZmkKCmxvZyAiTm9NQUQuYXBwIGluc3RhbGwgY29tcGxldGUiCmV4aXQgMA==</script_contents_encoded>
</script>